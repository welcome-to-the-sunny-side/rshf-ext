(()=>{"use strict";const t=".rated-user",e=[{maxRating:1199,className:"user-gray"},{maxRating:1399,className:"user-green"},{maxRating:1599,className:"user-cyan"},{maxRating:1899,className:"user-blue"},{maxRating:2099,className:"user-violet"},{maxRating:2399,className:"user-orange"},{maxRating:2999,className:"user-red"},{maxRating:1/0,className:"user-legendary"}];class n{static findUsernameElements(){console.log("[RSHF-EXT] Looking for elements with selector:",t);const e=document.querySelectorAll(t);return console.log(`[RSHF-EXT] Found ${e.length} elements with class 'rated-user'`),e}static extractUsernames(t){return Array.from(t).map((t=>t.textContent?.trim()||""))}static getRatingClassName(t){for(const n of e)if(t<=n.maxRating)return n.className;return"user-legendary"}static applyRatingStyle(t,e,n,s){console.log(`[RSHF-EXT] Applying rating style for ${t.textContent}, rating: ${e}`);const o=-1!==e,a=t.className.split(" "),r=a.filter((t=>!t.startsWith("user-")&&"rated-user"!==t));if(o){const s=this.getRatingClassName(e);t.className=["rated-user",s,...r].join(" "),t.removeAttribute("style"),t.setAttribute("title",`Alternative Rating: ${e} (${n.name})`),console.log(`[RSHF-EXT] Applied class: ${s} for rating: ${e}`)}else{switch(t.className=["rated-user",...r].join(" "),s.noGroupRatingStyle){case"opacity":const e=a.find((t=>t.startsWith("user-")));e?(t.classList.add(e),t.style.opacity="0.5"):(t.classList.add("user-gray"),t.style.opacity="0.5");break;case"strikethrough":const n=a.find((t=>t.startsWith("user-")));n?t.classList.add(n):t.classList.add("user-gray");const s=t;s.style.setProperty("text-decoration","line-through","important"),s.style.setProperty("text-decoration-color","rgba(0, 0, 0, 0.2)","important"),s.style.setProperty("text-decoration-thickness","1px","important"),console.log("[RSHF-EXT] Applied custom strikethrough to",t.textContent);break;case"brown":t.style.color="#964B00";break;case"asterisk":const o=a.find((t=>t.startsWith("user-")));if(o?t.classList.add(o):t.classList.add("user-gray"),!t.textContent?.includes("*")){const e=t.textContent||"",n=document.createElement("span");n.textContent="*",n.style.color="black",n.style.fontWeight="bold",t.textContent=e,t.appendChild(n),console.log("[RSHF-EXT] Added black asterisk to",e)}}t.setAttribute("title","No rating in selected group")}}static resetElementStyle(t){const e=t.className.split(" ").filter((t=>!t.startsWith("user-"))),n=t.getAttribute("data-original-color-class");n&&(e.push(n),t.removeAttribute("data-original-color-class")),t.className=e.join(" "),t.removeAttribute("style"),t.removeAttribute("title"),t.textContent?.endsWith("*")&&(t.textContent=t.textContent.slice(0,-1)),console.log(`[RSHF-EXT] Reset element style: ${t.textContent}`)}}console.log("[RSHF-EXT] Content script loaded!");const s={group:"abc",showAlternativeRating:!0,noGroupRatingStyle:"asterisk",maxReplacementsPerPage:2e3,cacheThresholdMinutes:30},o=t=>t<0||t<1200?"#808080":t<1400?"#008000":t<1600?"#03A89E":t<1900?"#0000ff":t<2100?"#a0a":t<2300||t<2400?"#FF8C00":"#ff0000",a=t=>t<0?"Not Rated":t<1200?"Newbie":t<1400?"Pupil":t<1600?"Specialist":t<1900?"Expert":t<2100?"Candidate Master":t<2300?"Master":t<2400?"International Master":t<2600?"Grandmaster":t<3e3?"International Grandmaster":"Legendary Grandmaster";let r=!0,i=!1;function l(){console.log("Codeforces Alternative Rating extension initialized"),function(){const t=document.createElement("button");t.textContent=r?"Disable Alt Ratings":"Enable Alt Ratings",t.style.cssText="\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    z-index: 9999;\n    padding: 8px 12px;\n    background: #4CAF50;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 14px;\n    opacity: 0.8;\n  ",t.addEventListener("click",d),document.body.appendChild(t)}(),i||(new MutationObserver((t=>{let e=!1;for(const n of t){if("childList"===n.type)for(const t of Array.from(n.addedNodes))if(t instanceof HTMLElement&&(t.classList?.contains("rated-user")||t.querySelector(".rated-user"))){e=!0;break}if(e)break}e&&r&&c()})).observe(document.body,{childList:!0,subtree:!0}),i=!0),c()}function c(){if(!r)return;console.log("Processing page with settings:",s);const t=n.findUsernameElements();if(console.log(`[RSHF-EXT] Found ${t.length} username elements`),t.length>0&&console.log("[RSHF-EXT] Sample elements:",Array.from(t).slice(0,3).map((t=>({text:t.textContent,classes:t.className,html:t.outerHTML})))),0===t.length)return;const e=n.extractUsernames(t);if(console.log(`[RSHF-EXT] Found ${e.length} usernames:`,e.slice(0,5),"..."),!s.showAlternativeRating)return console.log("[RSHF-EXT] Alternative ratings disabled in settings"),void Array.from(t).forEach((t=>{n.resetElementStyle(t)}));const i={};e.forEach((t=>{const e=Math.random()<.8;i[t]=e?Math.floor(4e3*Math.random()):-1})),console.log("[RSHF-EXT] Generated mock ratings:",Object.entries(i).slice(0,5)),Array.from(t).forEach(((t,r)=>{const l=e[r];if(!l)return;const c=i[l],d={color:o(c),name:a(c)};n.applyRatingStyle(t,c,d,s)}))}function d(){r=!r;const t=document.querySelector('button[style*="position: fixed"]');if(t&&(t.textContent=r?"Disable Alt Ratings":"Enable Alt Ratings",t.style.background=r?"#4CAF50":"#F44336"),r)c();else{const t=n.findUsernameElements();Array.from(t).forEach((t=>{n.resetElementStyle(t)}))}}"loading"===document.readyState?(console.log("[RSHF-EXT] Document still loading, waiting for DOMContentLoaded..."),document.addEventListener("DOMContentLoaded",(()=>{console.log("[RSHF-EXT] DOMContentLoaded fired, initializing..."),setTimeout((()=>{try{l(),console.log("[RSHF-EXT] Initialization complete")}catch(t){console.error("[RSHF-EXT] Initialization failed:",t)}}),500)}))):(console.log("[RSHF-EXT] Document already loaded, initializing..."),setTimeout((()=>{try{l(),console.log("[RSHF-EXT] Initialization complete")}catch(t){console.error("[RSHF-EXT] Initialization failed:",t)}}),500))})();